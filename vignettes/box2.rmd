
Box 2: A slightly less simple example: value of information for a plan to protect one species from two properties with continuous uncertainty
-------------------------------------------------------------------------------------------------------------------------------------------

In Box 1 we demonstrated how to calculate the value of information when the uncertainty in value was discrete (the value of a property could be zero or one because the value was derived from the species being present or absent). In the following example we increase the complexity slightly and demonstrate how to calculate EVPI when uncertainty is continuous. In all other aspects, the problem remains the same. A planner has the budget to protect one property for the conservation of an endangered species and there are two properties available.

Again, the planner's aim is to maximise the area of habitat protected. And again, the planner is uncertain about the habitat suitability of both properties. This time however, the true value and uncertainty of habitat suitability is continuous. Now the planner thinks that the habitat suitability of both properties can be __any value__ between zero and one, whereas before the planner thought the value could be __either__ zero or one. For the continuous case the habitat suitability can be described by a continuous probability distribution function (PDF). The planner uses a different PDF to describe the uncertainty in each property's value (Figure \ref{fig:plot_evwoi_cont_example}). For property 1 the PDF is symmetrical indicating that planner thinks it is equally probable that the value is less than .5 as it is probable that the value is greater than .5. In contrast, the planner believes that property 2 has a value that is more likely to be greater than .5 than not. Therefore, the PDF describing the value of property 2 is shifted to the right, having a greater mass over values between .5 and 1 than over values between 0 and .5.

### Expected value with original information

With these two PDFs, the planner can calculate the EVWOI. Again the planner needs to find the expected value of purchasing each property. The greater of the two, the maximum expected value, is the EVWOI. To find the expected value of a property's PDF the planner must integrate the PDF over the range of possible values. In Figure \ref{fig:plot_evwoi_cont_example} we demonstrate how this is done using Monte Carlo integration. This yields expected values of .52 and .62 for properties 1 and 2 respectively. Applying equation \ref{eq:evwoi} as in Box 1 we estimate the EVWOI is .62 and the optimal action for the planner would be to purchase and protect property 2.

```{r box2_data}
nsims <- 5

set.seed(34)

sim1 <- replicate(nsims, round(rbeta(1, 2.4, 1.6), 2))

sim2 <- replicate(nsims, round(rbeta(1, 2, 2), 2))

musim <- Map(mean, list(sim1, sim2))

msim <- pmax(sim1, sim2)

cEVWOI <- round(max(unlist(musim)), 2)
cEVWPI <- round(mean(msim), 2)
cEVPI  <- cEVWPI - cEVWOI
```

\vspace{12pt}
```{r plot_evwoi_cont_example, fig.cap = sprintf("How to calculate EVWOI with continuous uncertainty using Monte Carlo integration. Like in Figure \\ref{fig:plot_evwoi_bin_example}, EVWOI is the maximum expected value of the two properties. To calculate these expected values we generate samples from the respective PDFs and divide by the number of samples. By generating samples with probability according to their PDFs, as the number of samples increases, the estimate of expected value increases in accuracy. With %s samples the estimates are %s and %s (note that for property 2, which has an asymmetrical distribution, the expected value, its mean, is a little lower than its most probable value, the mode). Therefore the estimate of EVWOI is %s, the greater of the two. \\label{fig:plot_evwoi_cont_example}", nsims, round(musim[[1]], 2), round(musim[[2]], 2), cEVWOI)}
par(mfrow = c(1, 2), mar = c(0, 1, 3, 3), oma = c(15, 4, 0, 0), lwd = 2, ps = 12)
for (j in 0:1) {
  plot.new()
  plot.window(xlim = 0:1, ylim = 0:1, yaxs = "i")
  axis(1, at = 0:1, lwd = 0, lwd.ticks = 2)
  if (!j) mtext("PDF(Value)", 2, 1)
  curve(
    {
      if (j) dbeta(x, 2.4, 1.6) / 2 else dbeta(x, 2, 2) / 2
    }, 
    from = 0,
    to = 1,
    add = TRUE
  )
  title(paste0("Property ", j + 1))
  box()
  for (i in seq_len(nsims)) {
    if (j) {
      arrows(
        sim1[i],
        dbeta(sim1[i], 2.4, 1.6) / 2,
        sim1[i],
        -.25 - i * .2,
        .1,
        xpd = NA,
        lwd = .5,
        col = "grey"
      )
      text(
        sim1[i], -.25 - i * .2, sim1[i], xpd = NA, adj = c(.25, 1.4)
        )
    } else {
      arrows(
        sim2[i],
        dbeta(sim2[i], 2, 2) / 2,
        sim2[i],
        -.25 - i * .2,
        .1,
        xpd = NA,
        lwd = .5,
        col = "grey"
      )
      text(
        sim2[i], -.25 - i * .2, sim2[i], xpd = NA, adj = c(.25, 1.4),
        col = "grey"
      )
    }
  }
}

mtext("Value", 1, 1, outer = TRUE, adj = -.1)

mtext("Samples", 1, 6, outer = TRUE, adj = -.1)

mtext(
  bquote(
    frac(.(paste0(sim2, collapse = " + ")), .(nsims)) == .(round(musim[[2]], 2))
  ),
  1, 12.5, outer = TRUE, adj = 0, col = "grey"
)

mtext(
  bquote(
    frac(.(paste0(sim1, collapse = " + ")), .(nsims)) == .(round(musim[[1]], 2))
  ),
  1, 12.5, outer = TRUE, adj = .9
)

mtext(
  bquote(.("EVWOI") == .(round(max(unlist(musim)), 2))),
  1, 13.5, outer = TRUE, adj = .9
)
```

### Expected value with perfect information

Figure \ref{fig:plot_evwpi_cont_example} demonstrates the application of Monte Carlo integration to calculating EVWPI. Here the samples generated are the same as in figure \ref{fig:plot_evwpi_cont_example} (but they need not be). However this time we generate them as pairs and as in the calculation of EVWPI in Box 1, we maximise first on each pair and then take the average (mean) at the end to arrive at the expected value, which is our estimate of EVWPI. In essence to calculate EVWPI when uncertainty is continuous the planner can calculate the expected values of sets (in this case pairs) of Monte Carlo samples from the distributions characterising uncertainty and then average them much like they do the "scenarios" of the discrete example in Box 1.

\vspace{12pt}
```{r plot_evwpi_cont_example, fig.cap = sprintf("How to calculate EVWPI with Monte Carlo integration. For continuous uncertainty, unlike discrete uncertainty the number of possible outcomes/scenarios are infinite. Any combination of values between 0 and 1 for each property (though some values are more likely than others). As in Figure \\ref{fig:plot_evwoi_cont_example}, a convienent solution is to use Monte Carlo integration. We can estimate EVWPI by generating random samples in pairs, one sample from each of the property value PDFs, selecting the maximum sample in each pair (samples in black text) and then averaging by dividing by the number of samples generated. By selecting each pair in proportion to the probability distribution functions (PDFs) as we take more Monte Carlo samples the estimate of EVWPI approaches its true value. With the %s samples above we estimate an EVWPI of %s (which is close to the true value of .69, which is what we would get if we used a large number of samples. \\label{fig:plot_evwpi_cont_example}", nsims, cEVWPI)}
par(mfrow = c(1, 2), mar = c(0, 1, 3, 3), oma = c(15, 4, 0, 0), lwd = 2, ps = 12)
for (j in 0:1) {
  plot.new()
  plot.window(xlim = 0:1, ylim = 0:1, yaxs = "i")
  axis(1, at = 0:1, lwd = 0, lwd.ticks = 2)
  if (!j) mtext("PDF(Value)", 2, 1)
  curve(
    {
      if (j) dbeta(x, 2.4, 1.6) / 2 else dbeta(x, 2, 2) / 2
    }, 
    from = 0,
    to = 1,
    add = TRUE
  )
  title(paste0("Property ", j + 1))
  box()
  for (i in seq_len(nsims)) {
    if (j) {
      arrows(
        sim1[i],
        dbeta(sim1[i], 2.4, 1.6) / 2,
        sim1[i],
        -.25 - i * .2,
        .1,
        xpd = NA,
        lwd = .5,
        col = "grey"
      )
      text(
        sim1[i], -.25 - i * .2, sim1[i], xpd = NA, adj = c(.25, 1.4),
        col = ifelse(sim1[i] == msim[i], "black", "grey")
        )
    } else {
      arrows(
        sim2[i],
        dbeta(sim2[i], 2, 2) / 2,
        sim2[i],
        -.25 - i * .2,
        .1,
        xpd = NA,
        lwd = .5,
        col = "grey"
      )
      text(
        sim2[i], -.25 - i * .2, sim2[i], xpd = NA, adj = c(.25, 1.4),
        col = ifelse(sim2[i] == msim[i], "black", "grey")
      )
    }
  }
}

mtext("Value", 1, 1, outer = TRUE, adj = -.1)

mtext("Samples", 1, 6, outer = TRUE, adj = -.1)

mtext(
  bquote(
    plain("EVWPI") ==
    frac(.(paste0(msim, collapse = " + ")), .(nsims))
  ),
  1, 12.5, outer = TRUE, adj = 0
)

mtext(
  bquote(
    phantom(plain("EVWPI")) ==
      .(round(mean(msim), 2))
  ),
  1, 13.5, outer = TRUE, adj = 0
)
```

### Expected value of perfect information

Once again we use equation \ref{eq:evpi} to calculate EVPI. In this case EVPI is $`r cEVWPI` - `r cEVWOI` = \mathbf{`r  cEVPI`}$. Again, if they could express habitat value as money, they should be willing to spend up to 9% of the price of a property on gathering new information.
