
Box 2: A slightly less simple example: value of information for a plan to protect one species at two properties with continuous uncertainty
-------------------------------------------------------------------------------------------------------------------------------------------

In Box 1 we demonstrated how to calculate the value of information when the uncertainty in value was discrete (the value of a property could be zero or one). In the following example we increase the complexity slightly and demonstrate how to calculate EVPI when uncertainty is continuous. In all other aspects, the problem remains the same. A planner has the budget to protect one property for the conservation of an endangered species and there are two properties available.

Here again, the planner's aim is to maximise the area of habitat protected. And again, the planner is uncertain about the habitat suitability of both properties. This time however, the uncertainty in habitat suitability is continuous. Now the planner thinks that the habitat suitability of both properties can be __any value__ between zero and one, whereas before the planner thought the value could be __either__ zero or one. For the continous case the habitat suitability can be described by a probability distribution function (PDF). The planner uses a different PDF to describe the uncertainty in each properties value (Figure \ref{fig:plot_evwoi_cont_example}). For property 1 the PDF is symmetrical indicating that planner thinks it is equally probable that the value is less than .5 as it is probable that the value is greater than .5. In contrast, the planner believes that property 2 has a value that is more likely to be greater than .5 than not. Therefore, the PDF describing the value of property 2 is shifted to the right, having a greater mass over values between .5 and 1 than over values between 0 and .5.

### Expected value with original information

With these two PDFs, the planner can calculate the EVWOI. Again the planner needs to find the expected value of purchasing each property. The greater of the two, the maximum expected value, is the EVWOI. To find the expected value of a properties PDF the planner must integrate the PDF over the range of possible values. Doing so in this case yields an expected  

\vspace{12pt}
```{r plot_evwoi_cont_example, fig.cap = "How to calculate EVWOI with continuous uncertainty. The EVWOI in this case is even simpler than for the discrete case (Figure 2). Simply take the expected value of each properties' distribution of value, the maximum of which, is the EVWOI (note that for property 2, which has an asymmetrical distribution, the expected value, its mean, is a little lower than its most probable value, the mode)."}
par(mfrow = c(1, 2), mar = c(0, 1, 3, 3), oma = c(15, 4, 0, 0), lwd = 2, ps = 12)
nsims <- 5

set.seed(34)

sim1 <- replicate(nsims, round(rbeta(1, 2.4, 1.6), 2))
sim2 <- replicate(nsims, round(rbeta(1, 2, 2), 2))
musim <- Map(mean, list(sim1, sim2))

for (j in 0:1) {
  plot.new()
  plot.window(xlim = 0:1, ylim = 0:1, yaxs = "i")
  axis(1, at = 0:1, lwd = 0, lwd.ticks = 2)
  if (!j) mtext("PDF(Value)", 2, 1)
  curve(
    {
      if (j) dbeta(x, 2.4, 1.6) / 2 else dbeta(x, 2, 2) / 2
    }, 
    from = 0,
    to = 1,
    add = TRUE
  )
  title(paste0("Property ", j + 1))
  box()
  for (i in seq_len(nsims)) {
    if (j) {
      arrows(
        sim1[i],
        dbeta(sim1[i], 2.4, 1.6) / 2,
        sim1[i],
        -.25 - i * .2,
        .1,
        xpd = NA,
        lwd = .5,
        col = "grey"
      )
      text(
        sim1[i], -.25 - i * .2, sim1[i], xpd = NA, adj = c(.25, 1.4)
        )
    } else {
      arrows(
        sim2[i],
        dbeta(sim2[i], 2, 2) / 2,
        sim2[i],
        -.25 - i * .2,
        .1,
        xpd = NA,
        lwd = .5,
        col = "grey"
      )
      text(
        sim2[i], -.25 - i * .2, sim2[i], xpd = NA, adj = c(.25, 1.4),
        col = "grey"
      )
    }
  }
}

mtext("Value", 1, 1, outer = TRUE, adj = -.1)

mtext("Samples", 1, 6, outer = TRUE, adj = -.1)

mtext(
  bquote(
    frac(.(paste0(sim2, collapse = " + ")), .(nsims)) == .(round(musim[[2]], 2))
  ),
  1, 12.5, outer = TRUE, adj = 0, col = "grey"
)

mtext(
  bquote(
    frac(.(paste0(sim1, collapse = " + ")), .(nsims)) == .(round(musim[[1]], 2))
  ),
  1, 12.5, outer = TRUE, adj = .9
)

mtext(
  bquote(.("EVWOI") == .(round(max(unlist(musim)), 2))),
  1, 13.5, outer = TRUE, adj = .9
)

rm(i, j, nsims, sim1, sim2)
```

\vspace{12pt}
```{r plot_evwpi_cont_example, fig.cap = "How to calculate EVWPI with Monte Carlo sampling. For continuous uncertainty, unlike discrete uncertainty the number of possible outcomes/scenarios are infinite. Any combination of values between 0 and 1 for each property (though some values are more likely than others). One solution is to use Monte Carlo sampling. For example we can estimate the  EVWPI by selecting random pairs from the distribution of property values (numbers at the end of arrows above), selecting the maximum in each case (numbers in black text) and averaging by dividing by the number of samples. By selecting each pair in proportion to the probability distribution functions (PDFs) as we take more Monte Carlo samples the estimate of EVWPI approaches its true value. With the five samples above we estimate an EVWPI of .72 (which is close to the true value of .69, which we would get it if used a large number of samples."}
par(mfrow = c(1, 2), mar = c(0, 1, 3, 3), oma = c(15, 4, 0, 0), lwd = 2, ps = 12)
nsims <- 5

set.seed(34)

sim1 <- replicate(nsims, round(rbeta(1, 2.4, 1.6), 2))
sim2 <- replicate(nsims, round(rbeta(1, 2, 2), 2))
msim <- pmax(sim1, sim2)

for (j in 0:1) {
  plot.new()
  plot.window(xlim = 0:1, ylim = 0:1, yaxs = "i")
  axis(1, at = 0:1, lwd = 0, lwd.ticks = 2)
  if (!j) mtext("PDF(Value)", 2, 1)
  curve(
    {
      if (j) dbeta(x, 2.4, 1.6) / 2 else dbeta(x, 2, 2) / 2
    }, 
    from = 0,
    to = 1,
    add = TRUE
  )
  title(paste0("Property ", j + 1))
  box()
  for (i in seq_len(nsims)) {
    if (j) {
      arrows(
        sim1[i],
        dbeta(sim1[i], 2.4, 1.6) / 2,
        sim1[i],
        -.25 - i * .2,
        .1,
        xpd = NA,
        lwd = .5,
        col = "grey"
      )
      text(
        sim1[i], -.25 - i * .2, sim1[i], xpd = NA, adj = c(.25, 1.4),
        col = ifelse(sim1[i] == msim[i], "black", "grey")
        )
    } else {
      arrows(
        sim2[i],
        dbeta(sim2[i], 2, 2) / 2,
        sim2[i],
        -.25 - i * .2,
        .1,
        xpd = NA,
        lwd = .5,
        col = "grey"
      )
      text(
        sim2[i], -.25 - i * .2, sim2[i], xpd = NA, adj = c(.25, 1.4),
        col = ifelse(sim2[i] == msim[i], "black", "grey")
      )
    }
  }
}

mtext("Value", 1, 1, outer = TRUE, adj = -.1)

mtext("Samples", 1, 6, outer = TRUE, adj = -.1)

mtext(
  bquote(
    plain("EVWPI") ==
    frac(.(paste0(msim, collapse = " + ")), .(nsims))
  ),
  1, 12.5, outer = TRUE, adj = 0
)

mtext(
  bquote(
    phantom(plain("EVWPI")) ==
      .(round(mean(msim), 2))
  ),
  1, 13.5, outer = TRUE, adj = 0
)

rm(i, j, msim, nsims, sim1, sim2)
```

