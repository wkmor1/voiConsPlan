
Box 1: A simple example: value of information for a plan to protect one species at two properties
-------------------------------------------------------------------------------------------------

A conservation planner can afford to protect a property to help save an endangered species from extinction. Two properties are available.

The planner's aim is to maximise the area of habitat protected for the endangered species. The planner is uncertain about each property's __habitat suitability__. A property's habitat suitability can be either one (suitable) or zero (unsuitable). The first property has a 50% chance of being suitable (a 50% chance that habitat suitability is one, and a 50% chance that it is zero). But the planner knows that the second property has a slightly better chance (60%) of being suitable (i.e., a 40% chance it's unsuitable). The properties are identical in all other ways. A property can be protected __with original information__ (i.e., choosing a property while still ignorant of the habitat suitabilities) or __with perfect information__ (i.e., knowing the actual habitat suitabilities of each property in advance). The __value__ of protecting a property is its habitat suitability (i.e., the value can be zero or one). Regardless of they habitat suitability, an unprotected property has no value to the planner. The conservation planner must decide which property to protect.

### Expected value

The __expected value__ (EV) is the value the planner expects (but not necessarily what they get), given the outcome of their decision is uncertain. An __expected value__ is a value weighted (multiplied) by a probability (or in the case of a random variable a probability distribution function). Before they make a decision, the planner can work out the __expected value with original information__ (EVWOI) or the __expected value with perfect information__ (EVWPI). The __expected value of perfect information__ (EVPI) is the difference between the EVWPI and the EVWOI. If the EVPI is positive, it means it is worth (up to a point) learning before making a decision. For this example, if the EVPI is large enough, it is worth the planner working out what the habitat suitabilities of the two properties are, before they decide which one to protect. But if the EVPI is too low (when there is little difference between EVWOI and EVWPI) they should just decide which one to protect straightaway.

### Expected value with original information

The EVWOI is the highest value the planner expects they could get, on average (the __maximum expected value__), by protecting a property with only the information they have on habitat suitability at hand. To work out the expected value of protecting a property, the planner weights (i.e., multiplies) the values that are possible by their probabilities and adds them together.

\vspace{12pt}
```{r plot_evwoi_bin_example, fig.cap = "How to calculate EVWOI. First calculate the expected value of choosing to protect each property separately. The expected value of protecting a property is the values (the grey bars) that are possible, multiplied by their respective probabilities (the height of the grey bars) and then added together. EVWOI is the greatest (maximum) of the expected values. In this case, the EVWOI is the expected value of protecting property 2 is **0.6**."}
par(mfrow = c(1, 2), mar = c(0, 1, 3, 3), oma = c(8, 4, 0, 0), lwd = 2, ps = 12)
for (i in 0:1) {
  plot.new()
  plot.window(xlim = 0:1, ylim = 0:1, xaxs = 'i', yaxs = 'i')
  axis(1, at = c(.3, .7), labels = 0:1, lwd = 0, lwd.ticks = 2)
  axis(2, at = {if (!i) c(0, .5, 1) else integer()}, las = 1, lwd = 0,
    lwd.ticks = 2)
  barplot(c({if (i) .4 else .5}, {if (i) .6 else .5}), width = .2, space = 1,
    add = TRUE, border = NA, axes = FALSE, main = paste0('Property ', i + 1))
  if (i) {
    abline(h = .4, lty = 2)
    abline(h = .6, lty = 2)
  } else {
    mtext('Probability', 2, 3)
    abline(h = .5, lty = 2)
  }
  box()
  mtext({if (i) '(0.4' else '(0.5'}, 1, 4, at = .1)
  mtext(expression(phantom(0) %*% phantom(0)), 1, 4, at = .2)
  mtext(' 0)', 1, 4, at = .3) 
  mtext(expression(phantom(0) + phantom(0)), 1, 4, at = .4)
  mtext({if (i) '(0.6' else '(0.5'}, 1, 4, at = .5)
  mtext(expression(phantom(0) %*% phantom(0)), 1, 4, at = .6)
  mtext(' 1)', 1, 4, at = .7)
  mtext('=', 1, 4, at = .8)
  mtext({if (i) '0.6' else '0.5'}, 1, 4, at = .9)
  mtext({if (i) '0.6' else '0.5'}, 1, 5.5, at = .9)
  mtext({if (i) '}'}, 1, 5.5, at = .975)
  mtext({if (!i) 'max {'}, 1, 5.5, at = .75)
  mtext({if (!i) ','}, 1, 5.5, at = .975)
  arrows(
    c(.1, .5, .3, .7), c({if (i) .4 else .5}, {if (i) .6 else .5}, -.15, -.15),
    c(.1, .5, .3, .7), -c(.25, .25, .25, .25), .1, xpd = NA, col = 'grey25',
    lwd = 1
  )
}

mtext('EVWOI', 1, 7, at = 1, adj = 1, font = 2)
mtext('=', 1, 5.5, at = 1.05)
mtext('0.6', 1, 5.5, at = 1.15)
mtext('=', 1, 7, at = 1.05)
mtext('0.6', 1, 7, at = 1.15, font = 2)
mtext('Value', 1, 1, outer = TRUE, adj = -.1)
mtext('Max EV', 1, 5.5, outer = TRUE, adj = -.1, padj = -.1)
mtext('Expected\nvalue (EV)', 1, 4.5, outer = TRUE, adj = -.105, padj = -.3)
rm(i)
```

In this case, protecting the first property has a $0.5$ probability of having a value of $1$, and a $1 - 0.5 = 0.5$ probability of having a value of $0$. So, the expected value is: $$1 \times 0.5 + 0 \times (1 - 0.5) = 0.5.$$ The calculation for the second property is: $$1 \times 0.6 + 0 \times (1 - 0.6) = 0.6,$$ meaning the maximum expected value, EVWOI, is also $\mathbf{0.6}$. The calculation can be expressed as:

\begin{equation}
\mathrm{EVWOI} = Max_{a}[Mean_{s}(Value)].\label{eq:evwoi}
\end{equation}

Where $a$ represents the __action__ taken by the conservation planner, $s$ represents a __state__ (or scenario) (i.e., in this case it describes the information the planner has on the properties' habitat suitabilities). Taking the mean (average) for the states gives us the expected values.

#### Expected value with perfect information

The EVWPI is the value the planner expects if they knew the properties' habitat suitabilities before deciding which one to protect.

\vspace{12pt}
```{r plot_evwpi_bin_example, fig.cap = "How to calculate EVWPI. First work out the scenarios that are possible. Then choose the property to protect in each possible scenario. When the properties have equal value it doesn't matter which one is selected (e.g., in scenarios 3 &amp; 4). Next calculate the probability that the scenario occurs by multiplying the probabilities of the property habitat suitabilities (e.g., for scenario 1, the probability is $0.5 \\times 0.6 = 0.3$, see the rightmost arrows). Next multiply the scenario probabilties by the value of the properties selected in each scenario. Finally, sum the weighted scenario values (rightmost values). In this case the EVWPI is **0.8**."}
par(mfrow = c(1, 2), mar = c(0, 1, 3, 1), oma = c(15, 4, 0, 9), lwd = 2,
  ps = 12)
for (i in 0:1) {
  plot.new()
  plot.window(xlim = 0:1, ylim = 0:1, xaxs = 'i', yaxs = 'i')
  axis(1, at = c(.3, .7), labels = 0:1, lwd = 0, lwd.ticks = 2)
  axis(2, at = {if (!i) c(0, .5, 1) else integer()}, las = 1, lwd = 0,
    lwd.ticks = 2)
  barplot(c({if (i) .4 else .5}, {if (i) .6 else .5}), width = .2, space = 1,
    add = TRUE, border = NA, axes = FALSE, main = paste0('Property ', i + 1))
  if (i) {
    abline(h = .4, lty = 2)
    abline(h = .6, lty = 2)
    segments(1, .6, 1.3, .6, xpd = NA, lwd = 1, col = 'grey25')
    arrows(1.3, .6, 1.3, -.4, .1, xpd = NA, lwd = 1, col = 'grey25')
    arrows(1.1, .5, 1.1, -.4, .1, xpd = NA, lwd = 1, col = 'grey25')
  } else {
    mtext('Probability', 2, 3)
    abline(h = .5, lty = 2)
    segments(1, .5, 2.32, .5, xpd = NA, lwd = 1, col = 'grey25')
  }
  box()
  arrows({if (i) c(.3, .7) else c(.7, .3)}, c(-.3, -.3),
    {if (i) c(.3, .7) else c(.7, .3)}, -c(.95, .7), .1,
    col = {
      if (i) c('grey75', 'grey25') else c('grey25', 'grey75')
    }, xpd = NA, lwd = 1)
  for (j in 1:4 * 2 + 3) {
    if (!i) {
      if (j %in% c(5, 11)) {
        mtext({if (j > 9) '(0' else 0}, 1, j, at = .3,
          col = {if (j > 9) 'black' else 'grey75'})
      } else {
        mtext({if (j < 9) '(1' else 1}, 1, j, at = .7,
          col = {if (j < 9) 'black' else 'grey75'})
      }
    } else {
      if (j %in% c(7, 11)) {
        mtext(0, 1, j, at = .3, col = 'grey75')
      } else {
        mtext('(1', 1, j, at = .7)
      }
    }
  }
}
mtext('Value', 1, 1, outer = TRUE, adj = -.1)
mtext('(0.5', 1, 3, at = 1.05)
mtext(expression(phantom(0) %*% phantom(0)), 1, 3,  at = 1.2)
mtext('0.6)', 1, 3, at = 1.35)
mtext('=', 1, 3, at = 1.5)
mtext('0.3', 1, 3, at = 1.65)
arrows(1.5, -.6, 1.5, -.7, .1, xpd = NA, col = 'grey25', lwd = 1)

for (i in 1:4 * 2 + 3) {
  mtext(paste0('Scenario ', (i - 3) / 2), 1, i, outer = TRUE, adj = -.2)
  mtext(expression(phantom(0) %*% phantom(0)), 1, i, at = 1.2)
  mtext({if (i %in% c(7, 11)) '0.2)' else '0.3)'}, 1, i, at = 1.5)
  mtext('=', 1, i, at = 1.7)
  mtext({if (i %in% c(5, 9)) '0.3' else {if (i == 7) '0.2' else 0}}, 1, i,
    at = 1.8)
}
mtext('EVWPI', 1, 13, at = 1.65, adj = 1, font = 2)
mtext('=', 1, 13, at = 1.7)
mtext('0.8', 1, 13, at = 1.8, font = 2)
segments(1.85, -1.8, -1, xpd = NA)
rm(i, j)
```

In this case, there are four possible scenarios:

1. both properties are suitable,
2. the first is suitable while the second is not,
3. the second is suitable while the first is not, and
4. neither is suitable. 

Because the planner is only protecting one property, the value the planner gets from any one of these scenarios is the highest of the values of the two properties for that scenario (i.e., the value for scenarios 1, 2 and 3 is one, since there is at least one suitable property, while the value for scenario 4 is zero, since neither property is suitable). To work out the EVWPI, the planner takes the four maximum values (one for each scenario), and sums them, weighted by the scenarios' respective probabilities. The probability of a given scenario is the probability that the first property has the suitability stated in the scenario, multiplied by the probability that the second property has the suitability stated in the scenario. For scenarios 1 and 3, where the second property is suitable, the probability of the scenario is $0.5 \times 0.6 = 0.3$, irrespective of whether the first property is suitable or not. This is because the probability of the first property being suitable is the same as the probability that it is unsuitable (i.e., $0.5$). Similarly, for scenarios 2 and 4, where the second property is unsuitable, the probability is $0.5 \times 0.4 = 0.2$. So, the weighted values for scenarios 1 to 4, respectively, are: 

\begin{equation}
\begin{aligned}
&1 \times (0.5 \times 0.6) = 1 \times 0.3 = 0.3,\\ 
&1 \times (0.5 \times 0.4) = 1 \times 0.2 = 0.2,\\  
&1 \times (0.5 \times 0.6) = 1 \times 0.3 = 0.3,\ \mathrm{and}\\ 
&0 \times (0.5 \times 0.4) = 0 \times 0.2 = 0.
\end{aligned}
\end{equation}

The EVWPI is the sum of these weighted values, $0.3 + 0.2 + 0.3 + 0 = \mathbf{0.8}.$ In mathematical notation this can be expressed as:

\begin{equation}
\mathrm{EVWPI} = Mean_{s}[Max_{a}(Value)].\label{eq:evwpi}
\end{equation}

Here the symbols have the same meaning as in equation \ref{eq:evwoi}. But notice that instead of calculating the __action that maximises the expected value__ as in EVWOI, EVWPI is the __expected maximum value of action__. In other words, the order of maximisation and expectation has been reversed.

#### Expected value of perfect information

As noted above, the expected value of perfect information (EVPI) is the difference between the EVWPI and the EVWOI. Combining equations \ref{eq:evwoi} and \ref{eq:evwpi}, the EVPI can be expressed as:

\begin{equation}
\mathrm{EVPI} = \mathrm{EVWPI} - \mathrm{EVWOI}.\label{eq:evpi}
\end{equation}

In the conservation planner's case, EVPI is $0.8 - 0.6 = \mathbf{0.2}$, meaning that if they could express habitat value as money, they should be willing to spend up to 20% of the price of a property, but no more, on learning about habitat suitability, before they decide what to protect, because if the expense of gathering the information is greater than the expected benefit from acting on the accumulated information (new information plus original).

