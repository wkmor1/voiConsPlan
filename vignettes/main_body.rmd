Case study: a spatial conservation plan for the Hunter region, NSW, Australia
=============================================================================

To demonstrate how to incorporate the value of information in a systematic spatial conservation plan, we now turn to a case study on prioritizing the Hunter region for the conservation of threatened plants and animals. For the case study we make the simplifying assumptions that the entire region is an original position where no area is protected but the entire region is available for protection in a conservation plan. While this is entirely unrealistic, it would be unnecessary to complicate the demonstration with a more realistic scenario as the complication would only serve to distract the reader from the key components of the method we outline here.

Study area
----------

The Hunter is a biodiverse region of north-eastern New South Wales, Australia. The region is home to many threatened species of plants and animals. There are multiple threats to biodiversity in the region. The Hunter is under is under active development and the area's land users utilize it's resources for mining, agriculture, transport, urban infrastructure and conservation. For the the analyses we present here, we consider the Hunter region to include the local government areas of Cessnock, Dungog, Gloucester, Gosford, Greater Taree, Great Lakes, Lake Macquarie, Maitland, Musselbrook, Newcastle, Port Macquarie-Hastings, Port Stephens, Singleton, Upper Hunter and Wyong, an area of `r fmt(raster::cellStats(!is.na(predictors[[1]]), sum))` km$^2$.

Study species
-------------

The Hunter is home to many species of national conservation significance. Here we consider six species: two birds, two mammals and two plants. For the following analyses we build conservation plans that aim to maximise the average relative carrying capacity of these six species across the hunter region. Table 1 outlines these six species and an estimate of their maximum carrying capacity (see supplement for more details) as well as their conservation status according to the _NSW Threatened Species Conservation Act 1995_ (TSC), _Commonwealth Environment Protection and Biodiversity Conservation Act 1999_ (EPBC) and the IUCN Red list (IUCN).

\vspace{12pt}
```{r species_table, results = "asis"}
data_frame(
  `\\vrule width 0pt height 15pt depth 5pt\\relax Common Name` = paste0(
                          "\\vrule width 0pt height 15pt depth 5pt\\relax ",
                          c("Powerful Owl", "Spotted-tailed Quoll",
                            "Regent Honeyeater", "Squirrel Glider",
                            "Bynoe's Wattle", "Charmhaven Apple")
                        ),
  `Scientific Name` = paste0(
                        "\\textit{", 
                        c("Ninox strenua", "Dasyurus maculatus",
                          "Anthochaera phrygiam", "Petaurus norfolcensis",
                          "Acacia bynoeana", "Angophora inopina"),
                        "}"
                      ),
  `$\\bar{K}^\\mathrm{max}$` = c(.1, .2, 2, 150, 250, 18000),
  TSC = c("V", "V", "CE", "V", "E", "V"),
  EPBC = c("-", "E", "CE", "-", "V", "V"),
  IUCN = c("LC", "NT", "CE", "LC", "", "")
) %>%
xtable(
  caption = "Species used in the conservation plan for the Hunter region. LC = Least Concern;  NT = Near Threatened; V = Vulnerable; E = Endangered; CE = Critically Endangered. $\\bar{K}^\\mathrm{max}$ = Estimated maximum carrying capacity (number of individuals per square kilometre).",
  label = "species_table",
  align = "lllrlll",
  digits = 1
) %>%
print(include.rownames = FALSE, comment = FALSE, sanitize.text.function = I)
```

<!---
## Approximate maximum carrying capacity of the Hunter region

Powerful Owl home range is [1e4 to 5e4 hectares](http://www.publish.csiro.au/paper/MU06055.htm). Maximum Carrying capacity is probably something > .001 birds per hectare.

Tiger Quoll home range is [5e3 to 4e4 hectares](http://onlinelibrary.wiley.com/doi/10.1017/S0952836903004631/abstract). Maximum Carrying capacity is probably something > .002 quolls per hectare.

Squirrel Glider maximum carrying capacity is [1.5 gliders per hectare](http://www.alburyconservationco.org.au/wp-content/uploads/2012/10/Population-Viability-Analysis-for-Squirrel-Gliders-in-Thurgoona-NSW_20091.pdf).

Regent honeyeater: according to [this](http://www.publish.csiro.au/paper/PC990224.htm)
0.12 (+-.72) birds per hectare (not normally distributed though). So a rough guess may be 2 birds per hectare.

Angophora inopina: to [this](http://www.publish.csiro.au/paper/BT03058.htm) 1100 trees where found in 6.2 hectare. So approximately 180 plants per hectare.

Acacia bynoeana: [1600 plants](https://www.environment.gov.au/cgi-bin/sprat/public/publicspecies.pl?taxon_id=8575) / [650ha](http://www.environment.nsw.gov.au/resources/parks/PoMLakeMacquarieSCAPulbahIslandNRMoonIslandNR.pdf)So approximately plants per 2.5 plants per hectare.
--->

\newpage
```{r box2, child = "box2.rmd"}
```
\newpage

Input data for the conservation plan
------------------------------------

### Predictors of species distributions

We summarise the environment of the Hunter region with six data layers: annual mean solar radiation, annual mean temperature, annual precipitation, precipitation seasonality (coefficient of variation), inherent soil fertility, and topographic wetness index. Each layer is a `r nrow(predictors)` by `r ncol(predictors)` grid of 1 km$^2$ cells. We chose this set of variables as they are publicly available (see supplement for sources), are biologically plausible drivers of the distribution of many taxa, have previously been shown to predict the distributions of the study species in the region [**cite**] and are relatively uncorrelated with one another (maximum Pearson correlation coefficient = `r  fmt(max(abs(sort(raster::layerStats(predictors, "pearson", na.rm = TRUE)[[1]], TRUE)[-1:-raster::nlayers(predictors)])), 2)`).

### Species occurence data

We obtained 30 random occurrence records within the boundaries of the Hunter region (as defined above) and collected within the date range, January 1, 1996 to May 1, 2016, for each of the six study species from the Atlas of Living Australia database [**cite**]. We chose this relatively low sample-size random subset to ensure that subsequent modelling would have an initial level of uncertainty large enough for us to demonstrate how to calculate the value of information.

### Background geographic data

To fit distribution models with the occurrence records and environmental predictors, we used a set of background points selected so as to minimise sampling bias in the occurrence points. For each higher taxonomic group (birds, mammals and plants), the background points were selected by randomly sampling 10,000 occurrence records of all taxa belonging to each group from the Atlas of Living Australia database for the same spatial and temporal extent indicated above.

Modelling species distributions using MaxEnt
--------------------------------------------

We used the software MaxEnt [**cite**] to create species distribution maps on which to base the conservation plan. MaxEnt can be used to describe the potential distribution of species with occurrence records alone. The algorithm does this by comparing the distribution of occurrence records in covariate space to the distribution of covariate space as a whole, also known as the background (see below). We fit MaxEnt models to each species with only linear and quadratic features enabled.

\vspace{12pt}
```{r plot_models, fig.cap = "Distribution of study species in the Hunter region. Maps show the relative carrying capacity (logistic output) of each species estimated by fitting Maxent models."}
gg_raster(models, spp_of_interest, 2) +
scale_fill_viridis(na.value = NA, name = expression(bar(italic(K))^"max")) +
guides(fill = guide_colourbar(barheight = 10)) +
theme(
  axis.text  = element_blank(),
  axis.title = element_blank(),
  strip.text = element_text(face = "italic")
)
```

### Intepreting the output of MaxEnt

Interpreting MaxEnt output in both it's native formats (raw and logistic) has in the past proved problematic and controversial. It has been shown that it while it is equally problematic to interpret MaxEnt output as either relative occurrence rate or probability of presence, it is legitimate to interpret MaxEnt output as an indicator of relative habitat suitability [**cite**]. Here we chose to interpret the logistic output of MaxEnt as a rough indicator of relative carrying capacity. Where the logistic output is zero, the carrying capacity should be zero (or close to zero) and where the output is one, the carrying capacity should be close to the maximum attainable for the species. When the output is some fraction of one, then we assume the carrying capacity is that fraction of the maximum. The important caveat here is that the relationship between MaxEnt logistic output and carrying capacity is assumed linear. While there is no prima facie reason that it should be. Equally there is no prima facie reason there should be some more complicated relationship. Therefore, linearity would seem to be the most logical initial assumption, in the absence of information to the contrary. In any case, any conceivable deviation from linearity should not matter too much here, as the species of interest have carrying capacities that vary over many orders of magnitude \ref{table:species_table}. The benefit of interpreting the MaxEnt output in such a way is that we can use the modelled distribution maps to calculate an estimate of the total potential population size for each species. And subsequently once we have a conservation plan, we can calculate the potential impact on that population size of the plan, or other competing plans.

Incorporating uncertainty
-------------------------

To calculate the value of information requires some means of quantifying the level of uncertainty in a prediction of the system state. One way to express the uncertainty in species distributions is to consider a set of distribution maps where each map is equally likely to represent the true distribution, in instead having a single map that alone describes the distribution of a species. The multi-map description of species distributions acknowledges that species distributions a modelled based on a sample of points and those points are used to estimate the species relationship to the environment. As the points are a sample, the estimated relationship will be inherently uncertain.

### Uncertainty and MaxEnt

Fitting a MaxEnt model with a set of occurrence points does not by itself account for uncertainty in a species' distribution. It provides a single possible realization (even if it is a likely, or most likely one) of a species distribution and does not account for the fact that the distribution was estimated from a sample of occurrence points and is therefore inherently uncertain. MaxEnt does not natively account for uncertainty. That is, at the time of writing, the MaxEnt software does not provide a means of quantifying uncertainty in its output, and only provides a single map for a single sample of species occurrence points and background dataset.

### The bootstrap

To overcome the shortcomings in the MaxEnt software's ability to incorporate uncertainty we use a statistical method known as the bootstrap. At heart the bootstrap is a simple technique that can be used to describe uncertainty in quantities that have been generated by a model. Many improvements and extensions have been made to the bootstrap since its introduction, but here, for simplicities sake, we focus on and employ the basic bootstrap. In essence the bootstrap quantifies uncertainty by refitting a model to a dataset that has been resampled with replacement. For example, if we fit a model to a dataset consisting of three data-points labelled A, B and C (note for the purposes of the bootstrap it is unimportant how many variables they consists of and what value(s) the data-points take), there are ten bootstrap samples to fit models to (AAA, AAB, AAC, ABC, ABB, ACC, BBB, BBC, BCC and CCC), and ten possible outputs that describe the uncertainty of the model fitted to the data-set. However, as the sample-size increases the number of possible bootstrap samples increases rapidly (e.g. for the sample-size of only 30 used in this case study there are almost $6\times10^16$ different possible bootstrap samples) so in practice a random (or Monte Carlo) set of $n$ bootstrap sample is used to estimate the bootstrapped quantities' uncertainty.

To bootstrap a species distribution model using MaxEnt we resample the 30 occurrence points 1000 times and run the MaxEnt algorithm on each set to output 1000  distribution maps.We performed the bootstrap on a MaxEnt model for each of the six focal species. Note that we only bootstrap the species occurrence data and not the background as this is considered a fixed model parameter for our purposes.

Prioritizing with Zonation
--------------------------

We used the spatial planning sofware Zonation [**cite**] to make a conservation plan for the Hunter Region. The conservation plan we implement here has a budget large enough to protect 10% of the hunter region (with simplifying assumption that all of the hunter has the potential to be protected and that any 10% will have cost equal to the budget). The objective of the conservation plan is to minimise the average proportional loss (maximise the average proportion remaining) of total carrying capacity of the six species of interest. We give equal weight to each species (no species is prefererred over any other).

The Zonation software uses a greedy algorithm to rank grid cells in order of priorty such that preserving the highest ranked 10% of grid cells is the approximately maximal solution to the objective above. The Zonation algorithm works be iteratively removing grid cells that contribute the least to the objective. The removal process is repeated until all cells have been removed and the order of removal constitutes the ranking of the cells (the last cell to be removed being the highest ranked and the first cell the lowest ranked). Zonation provides a number of implementations of its greedy algorithm that differ by the way they calculate the contribution of each cell to the objective (the basis on which cell removal is determined). Here we use Zonation's "additive benefit" cell removal rule whereby cells that contribute the least to the average proportion of value remaining are removed first.

\newpage
```{r box3, child = "box3.rmd"}
```
\newpage

The expected value of information for the Hunter region conservation plan
-------------------------------------------------------------------------

\vspace{12pt}
```{r plot_plan, fig.cap = "Priority map for the Hunter region. Pixels have been ranked from lowest priority (blue) to highest priority (yellow) using the Zonation greedy algorithm. The additive benefit function was used to iteratively remove cells with the lowest marginal benefit. In calculating marginal benefit each species was weighted equally. The map can be used to calculate the expected value with original information for a fixed budget (number of cells protected) with value measured as the average proportion of species total carrying capacity remaining if all unprotected cells were removed."}
gg_raster(plan$rasters$rank, highlight = c(.9, 1)) +
scale_fill_viridis(na.value = NA, name = "Rank") +
guides(fill = guide_colourbar(barheight = 10, label = FALSE)) +
theme(axis.text = element_blank(), axis.title = element_blank())
```

\vspace{12pt}
```{r plot_plan_uncertainty, fig.height = 3.4, fig.cap = "Uncertainty in pixel ranks. Pixels are displayed in order of their priority. Grey bars indicate the 95% inner quantile of the priority rankings based on the bootstrapped maps. Pixels which have mean values above the red horizontal line are included in the conservation plan under original information."}
plans_boot_df <-
  sapply(plans_boot, values) %>%
  apply(1L, function(x) c(mean = mean(x), min = min(x), max = max(x))) %>%
  t %>% data.frame %>% mutate(hl = min < .9 & max > .9)

grid.arrange(
  na.omit(plans_boot_df) %>%
  arrange(mean) %>%
  mutate(x = seq(0, 1, length.out = n())) %>%
  slice(floor(seq.int(1, n(), length.out = 10000))) %>%
  ggplot +
  geom_hline(aes(yintercept = .9)) +
  geom_ribbon(aes(x = x, y = mean, ymin = min, ymax = max, alpha = hl)) +
  scale_alpha_discrete(guide = "none", range = c(.3, 1)) +
  theme_bw() +
  theme(
    axis.title  = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank()
  ) +
  coord_fixed(.715),
  gg_raster(plan$rasters$rank, highlight = plans_boot_df$hl) +
  scale_fill_viridis(na.value = NA, name = "Rank") +
  guides(fill = guide_colourbar(barheight = 10, label = FALSE)) +
  theme(axis.text = element_blank(), axis.title = element_blank()),
  nrow = 1,
  padding = 0
)

```

\vspace{16pt}
```{r evi_table, results = "asis"}
data_frame(
  `\\vrule width 0pt height 17pt depth 5pt\\relax Expected value` =
    paste0("\\vrule width 0pt height 15pt depth 5pt\\relax ",
           c("EVWOI", "EVWPI", "EVPI")
    ),
  `\\pbox{20cm}{Average proportion of\\\\carrying capacity remaining}` =
    c(evwoi, evwpi, evwpi - evwoi) * 100
) %>%
xtable(
  caption = "Something",
  label = "evi_table",
  align = "llr",
  digits = 1
) %>%
print(include.rownames = FALSE, comment = FALSE, sanitize.text.function = I)
```
