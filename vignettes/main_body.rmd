Case study: a spatial conservation plan for the Hunter region, NSW, Australia
=============================================================================

To demonstrate how to incorporate the value of information in a systematic spatial conservation plan, we now turn to a case study on prioritizing the Hunter region for the conservation of threatened plants and animals. For the case study we make the simplifying assumptions that the entire region is an original position where no area is protected but the entire region is available for protection in a conservation plan. While this is entirely unrealistic, it would be unnecessary to complicate the demonstration with a more realistic scenario as the complication would only serve to distract the reader from the key components of the method we outline here.

Study area
----------

The Hunter is a biodiverse region of north-eastern New South Wales, Australia. The region is home to many threatened species of plants and animals. There are multiple threats to biodiversity in the region. The Hunter is under is under active development and the area's land users utilize it's resources for mining, agriculture, transport, urban infrastructure and conservation. For the the analyses we present here, we consider the Hunter region to include the local government areas of Cessnock, Dungog, Gloucester, Gosford, Greater Taree, Great Lakes, Lake Macquarie, Maitland, Musselbrook, Newcastle, Port Macquarie-Hastings, Port Stephens, Singleton, Upper Hunter and Wyong, an area of `r fmt(raster::cellStats(!is.na(predictors[[1]]), sum))` km$^2$.

Study species
-------------

The Hunter is home to many species of national conservation significance. Here we consider six species: two birds, two mammals and two plants. For the following analyses we build conservation plans that aim to maximise the average relative carrying capacity of these six species across the hunter region. Table 1 outlines these six species and an estimate of their maximum carrying capacity (see supplement for more details) as well as their conservation status according to the _NSW Threatened Species Conservation Act 1995_ (TSC), _Commonwealth Environment Protection and Biodiversity Conservation Act 1999_ (EPBC) and the IUCN Red list (IUCN).

\vspace{12pt}
```{r species_table, results = "asis"}
data_frame(
  `\\vrule width 0pt height 15pt depth 5pt\\relax Common Name` = paste0(
                          "\\vrule width 0pt height 15pt depth 5pt\\relax ",
                          c("Powerful Owl", "Spotted-tailed Quoll",
                            "Regent Honeyeater", "Squirrel Glider",
                            "Bynoe's Wattle", "Charmhaven Apple")
                        ),
  `Scientific Name` = paste0(
                        "\\textit{", 
                        c("Ninox strenua", "Dasyurus maculatus",
                          "Anthochaera phrygiam", "Petaurus norfolcensis",
                          "Acacia bynoeana", "Angophora inopina"),
                        "}"
                      ),
  `$\\bar{K}^\\mathrm{max}$` = c(.1, .2, 2, 150, 250, 18000),
  TSC = c("V", "V", "CE", "V", "E", "V"),
  EPBC = c("-", "E", "CE", "-", "V", "V"),
  IUCN = c("LC", "NT", "CE", "LC", "", "")
) %>%
xtable(
  caption = "Species used in the conservation plan for the Hunter region. LC = Least Concern;  NT = Near Threatened; V = Vulnerable; E = Endangered; CE = Critically Endangered. $\\bar{K}^\\mathrm{max}$ = Estimated maximum carrying capacity (no individuals per square kilometre).",
  label = "species_table",
  align = "lllrlll",
  digits = 1
) %>%
print(include.rownames = FALSE, comment = FALSE, sanitize.text.function = I)
```

<!---
## Approximate maximum carrying capacity of the Hunter region

Powerful Owl home range is [1e4 to 5e4 hectares](http://www.publish.csiro.au/paper/MU06055.htm). Maximum Carrying capacity is probably something > .001 birds per hectare.

Tiger Quoll home range is [5e3 to 4e4 hectares](http://onlinelibrary.wiley.com/doi/10.1017/S0952836903004631/abstract). Maximum Carrying capacity is probably something > .002 quolls per hectare.

Squirrel Glider maximum carrying capacity is [1.5 gliders per hectare](http://www.alburyconservationco.org.au/wp-content/uploads/2012/10/Population-Viability-Analysis-for-Squirrel-Gliders-in-Thurgoona-NSW_20091.pdf).

Regent honeyeater: according to [this](http://www.publish.csiro.au/paper/PC990224.htm)
0.12 (+-.72) birds per hectare (not normally distributed though). So a rough guess may be 2 birds per hectare.

Angophora inopina: to [this](http://www.publish.csiro.au/paper/BT03058.htm) 1100 trees where found in 6.2 hectare. So approximately 180 plants per hectare.

Acacia bynoeana: [1600 plants](https://www.environment.gov.au/cgi-bin/sprat/public/publicspecies.pl?taxon_id=8575) / [650ha](http://www.environment.nsw.gov.au/resources/parks/PoMLakeMacquarieSCAPulbahIslandNRMoonIslandNR.pdf)So approximately plants per 2.5 plants per hectare.
--->

Input data for the conservation plan
------------------------------------

### Predictors of species distributions

We summarise the environment of the Hunter region with six data layers: annual mean solar radiation, annual mean temperature, annual precipitation, precipitation seasonality (coefficient of variation), inherent soil fertility, and topographic wetness index (Figure ?). Each layer is a `r nrow(predictors)` by `r ncol(predictors)` grid of 1 km$^2$ cells. We chose this set of variables as they are publicly available (see supplement for sources), are biologically plausible drivers of the distribution of many taxa, have previously been shown to predict the distributions of the study species in the region [**cite**] and are relatively uncorrelated with one another (maximum Pearson correlation coefficient = `r  fmt(max(abs(sort(raster::layerStats(predictors, "pearson", na.rm = TRUE)[[1]], TRUE)[-1:-raster::nlayers(predictors)])), 2)`).

### Species occurence data

We obtained 30 random occurrence records within the boundaries of the Hunter region (as defined above) and within the date range, 1996 to 2016, for each of the six study species from the Atlas of Living Australia database [**cite**]. We chose this relatively low sample-size random subset to ensure that subsequent modelling would have an initial level of uncertainty large enough for us to demonstrate how to calculate the value of information.
\newpage

```{r box2, child = "box2.rmd"}
```
\newpage

Modelling species distributions using MaxEnt
--------------------------------------------

We used the software MaxEnt [**cite**] to create species distribution maps on which to base the conservation plan. MaxEnt can be used to describe the potential distribution of species with occurrence records alone. The algorithm does this by comparing the distribution of occurrence records in covariate space to the distribution of covariate space as a whole, also known as the background (see below). We fit MaxEnt models to each species with only linear and quadratic features enabled.

\vspace{12pt}
```{r plot_models, fig.cap = "Distribution of study species in the Hunter region. Maps show the relative carrying capacity (logistic output) of each species estimated by fitting Maxent models to the occurrence data in Figure ? using the predictor set in Figure ? and background data in Figure ?."}
gg_raster(models, spp_of_interest, 2) +
scale_fill_viridis(na.value = NA, name = "") +
guides(fill = guide_colourbar(barheight = 10)) +
theme(
  axis.text  = element_blank(),
  axis.title = element_blank(),
  strip.text = element_text(face = "italic")
)
```

### Background geographic data

To fit distribution models with the occurrence records and environmental predictors we used a set of background points selected so as to minimise sampling bias in the occurrence points. For each higher taxonomic group (birds, mammals and plants) the background points were selected by randomly sampling 10,000 occurrence records of all taxa belonging to each group for the same spatial and temporal extent indicated above.
\newpage

### Intepreting the output of MaxEnt

Interpreting MaxEnt output in both it's native formats (raw and logistic) has in the past proved problematic and controversial. It has been shown that it equally problematic to interpret MaxEnt output as either relative occurrence rate or probability of presence it is legitimate to interpret MaxEnt output as an indicator of relative habitat suitability. Here we chose to interpret the logistic output of MaxEnt as a rough indicator of relative carrying capacity. Where the logistic output is zero, the carrying capacity should be zero (or close enough to zero) and where the output is one, the carrying capacity should be close to the maximum attainable for the species. When the output is some fraction of one then we assume the carrying capacity is that fraction of the maximum. The important caveat here is that the relationship between MaxEnt logisitic output and carrying capacity is linear. While there is no prima facie region that it should, be it is seems the most logical assumption and any conceivable deviation from lineararity should not matter too much in the present case as the species of interest here have carrying capacities that vary over many orders of magnitude. The benefit of intepreting the MaxEnt output in such a way is that we can use the distribution maps to calculate an estimate of total potential population size for each species. And subsequently once we have a conservation plan, we can calculate the potential impact on population size of the plan or other competing plans. 

Incorporating uncertainty 
-------------------------

Simply fitting a MaxEnt model with a set of occurrence points does not by itself account for the uncertainty in species

Prioritizing with Zonation
-------------------------

```{r box3, child = "box3.rmd"}
```
\newpage

\vspace{12pt}
```{r plot_plan, fig.cap = "Priority map for the Hunter region. Pixels have been ranked from lowest priority (blue) to highest priority (yellow) using the Zonation greedy algorithm. The additive benefit function was used to iteratively remove cells with the lowest marginal benefit. In calculating marginal benefit each species was weighted equally. The map can be used to calculate the expected value with original information for a fixed budget (number of cells protected) with value measured as the average proportion of species total carrying capacity remaining if all unprotected cells were removed."}
gg_raster(plan$rasters$rank, highlight = c(.9, 1)) +
scale_fill_viridis(na.value = NA, name = "Rank") +
guides(fill = guide_colourbar(barheight = 10, label = FALSE)) +
theme(axis.text = element_blank(), axis.title = element_blank())
```

\vspace{12pt}
```{r plot_plan_uncertainty, fig.height = 3.4, fig.cap = "Uncertainty in pixel ranks. Pixels are displayed in order of their priority. Grey bars indicate the 95% inner quantile of the priority rankings based on the bootstrapped maps. Pixels which have mean values above the red horizontal line are included in the conservation plan under original information."}
plans_boot_df <-
  sapply(plans_boot, values) %>%
  apply(1L, function(x) c(mean = mean(x), min = min(x), max = max(x))) %>%
  t %>% data.frame %>% mutate(hl = min < .9 & max > .9)

grid.arrange(
  na.omit(plans_boot_df) %>%
  arrange(mean) %>%
  mutate(x = seq_len(n())) %>%
  slice(floor(seq.int(1, n(), length.out = 10000))) %>%
  ggplot +
  geom_hline(aes(yintercept = .9)) +
  geom_ribbon(aes(x = x, y = mean, ymin = min, ymax = max, alpha = hl)) +
  scale_alpha_discrete(guide = "none", range = c(.3, 1)) +
  theme_bw() +
  theme(
    axis.title  = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank()
  ),
  gg_raster(plan$rasters$rank, highlight = plans_boot_df$hl) +
  scale_fill_viridis(na.value = NA, name = "Rank") +
  guides(fill = guide_colourbar(barheight = 10, label = FALSE)) +
  theme(axis.text = element_blank(), axis.title = element_blank()),
  nrow = 1,
  padding = 0
)

```

\vspace{12pt}
```{r evi_table, results = "asis"}
data_frame(
  `\\vrule width 0pt height 17pt depth 5pt\\relax Expected value` =
    paste0("\\vrule width 0pt height 15pt depth 5pt\\relax ",
           c("EVWOI", "EVWPI", "EVPI")
    ),
  `\\pbox{20cm}{Average proportion of\\\\carrying capacity remaining}` =
    c(evwoi, evwpi, evwpi - evwoi) * 100
) %>%
xtable(
  caption = "Something",
  label = "evi_table",
  align = "llr",
  digits = 1
) %>%
print(include.rownames = FALSE, comment = FALSE, sanitize.text.function = I)
```
